
sudo killall xterm
sudo rmmod nasmesh
#export OPENAIR2_DIR=/homes/anouar/openair2/
#export OPENAIR2_DIR=/root/openair_trials_2/openair2/
sleep 2
cd $OPENAIR2_DIR



sudo insmod NAS/DRIVER/MESH/nasmesh.ko

# Clusterhead0
sudo ifconfig nasmesh0 10.0.1.1 netmask 255.255.255.0 broadcast 10.0.1.255 

# CH1
sudo ifconfig nasmesh1 10.0.2.2 netmask 255.255.255.0 broadcast 10.0.2.255

# UE1 
sudo ifconfig nasmesh2 10.0.3.3 netmask 255.255.255.0 broadcast 10.0.3.255

# UE2 
sudo ifconfig nasmesh3 10.0.4.4 netmask 255.255.255.0 broadcast 10.0.4.255

# UE3 
sudo ifconfig nasmesh4 10.0.5.5 netmask 255.255.255.0 broadcast 10.0.5.255
# Classification rules


# CH0 <-> UE1 on DSCP 0 (RB 12)
$OPENAIR2_DIR/NAS/DRIVER/MESH/RB_TOOL/rb_tool -a -c0 -i0 -z0 -s 10.0.1.1 -t 10.0.1.3 -r 12
# CH <-> UE1 on DSCP 4 (RB 13)
$OPENAIR2_DIR/NAS/DRIVER/MESH/RB_TOOL/rb_tool -a -c0 -i0 -z4 -s 10.0.1.1 -t 10.0.1.3 -r 13

# CH0 <-> UE2 on DSCP 0 (RB 20)
$OPENAIR2_DIR/NAS/DRIVER/MESH/RB_TOOL/rb_tool -a -c1 -i0 -z0 -s 10.0.1.1 -t 10.0.1.4 -r 20
# CH <-> UE2 on DSCP 4 (RB 21)
$OPENAIR2_DIR/NAS/DRIVER/MESH/RB_TOOL/rb_tool -a -c1 -i0 -z4 -s 10.0.1.1 -t 10.0.1.4 -r 21


# CH1 <-> UE1 on DSCP 0 (RB 12)
$OPENAIR2_DIR/NAS/DRIVER/MESH/RB_TOOL/rb_tool -a -c0 -i1 -z0 -s 10.0.2.2 -t 10.0.2.3 -r 12
# CH <-> UE1 on DSCP 4 (RB 13)
$OPENAIR2_DIR/NAS/DRIVER/MESH/RB_TOOL/rb_tool -a -c0 -i1 -z4 -s 10.0.2.2 -t 10.0.2.3 -r 13

# CH1 <-> UE3 on DSCP 0 (RB 28)
$OPENAIR2_DIR/NAS/DRIVER/MESH/RB_TOOL/rb_tool -a -c1 -i1 -z0 -s 10.0.2.2 -t 10.0.2.5 -r 28
# CH1 <-> UE3 on DSCP 4 (RB 29)
$OPENAIR2_DIR/NAS/DRIVER/MESH/RB_TOOL/rb_tool -a -c1 -i1 -z4 -s 10.0.2.2 -t 10.0.2.5 -r 29


# UE1 <-> CH0 on DSCP 0 (RB 4)
$OPENAIR2_DIR/NAS/DRIVER/MESH/RB_TOOL/rb_tool -a -c0 -i2 -z0 -s 10.0.3.3 -t 10.0.3.1 -r 4 
# UE <-> CH0 on DSCP 4 (RB 5)
$OPENAIR2_DIR/NAS/DRIVER/MESH/RB_TOOL/rb_tool -a -c0 -i2 -z4 -s 10.0.3.3 -t 10.0.3.1 -r 5


# UE1 <-> CH1 on DSCP 0 (RB 12)
$OPENAIR2_DIR/NAS/DRIVER/MESH/RB_TOOL/rb_tool -a -c1 -i2 -z0 -s 10.0.3.3 -t 10.0.3.2 -r 12 
# UE <-> CH1 on DSCP 4 (RB 13)
$OPENAIR2_DIR/NAS/DRIVER/MESH/RB_TOOL/rb_tool -a -c1 -i2 -z4 -s 10.0.3.3 -t 10.0.3.2 -r 13


# UE2 <-> CH0 on DSCP 0 (RB 4)
$OPENAIR2_DIR/NAS/DRIVER/MESH/RB_TOOL/rb_tool -a -c0 -i3 -z0 -s 10.0.4.4 -t 10.0.4.1 -r 4 
# UE2 <-> CH0 on DSCP 4 (RB 5)
$OPENAIR2_DIR/NAS/DRIVER/MESH/RB_TOOL/rb_tool -a -c0 -i3 -z4 -s 10.0.4.4 -t 10.0.4.1 -r 5


# UE3 <-> CH1 on DSCP 0 (RB 4)
$OPENAIR2_DIR/NAS/DRIVER/MESH/RB_TOOL/rb_tool -a -c0 -i4 -z0 -s 10.0.5.5 -t 10.0.5.2 -r 12 
# UE3 <-> CH1 on DSCP 4 (RB 5)
$OPENAIR2_DIR/NAS/DRIVER/MESH/RB_TOOL/rb_tool -a -c0 -i4 -z4 -s 10.0.5.5 -t 10.0.5.2 -r 13

sudo rm /tmp/*socket*
cd ../openair3/MESH/RRM/
#sudo xterm -T RRM -hold -e sh rrm_5nodes.sh &
sudo xterm -T RRM -hold -e sh rrm.sh &
sleep 5

cd $OPENAIR2_DIR/SIMULATION/USER_TOOLS/LAYER2_SIM
sudo ./mac_sim_rrm -m0 -t ../../TOPOLOGIES/virtual_5nodes.top




